function [dX, extraOut] = odeSolver(t, X, Robot)

    q1 =  X(1);
    q2 =  X(2);
    q3 =  X(3);
    dq1 = X(4);
    dq2 = X(5);
    dq3 = X(6);


    M = [                                                                                               (cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)^2 + (cos(q1)^2*cos(q2)^2)/4 + (cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2)^2 + (cos(q2)^2*sin(q1)^2)/4 + 1/4,                                                                                               (cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2) - (cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2),                                                                                                                                   ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2) - ((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)
        (cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2) - (cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2),                                                                                               cos(q1)^2/6 + cos(q2)^2/4 + sin(q1)^2/6 + (cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)^2 + (cos(q2) + (cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2)^2 + (cos(q1)^2*sin(q2)^2)/4 + (sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)^2 + (sin(q1)^2*sin(q2)^2)/4, cos(q1)^2/12 + ((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) + sin(q1)^2/12 + ((cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2)*(cos(q2) + (cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2) + ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)
        ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2) - ((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2), cos(q1)^2/12 + ((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) + sin(q1)^2/12 + ((cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2)*(cos(q2) + (cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2) + ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2),                                                                                                                                                                                                             cos(q1)^2/12 + sin(q1)^2/12 + ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)^2 + ((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)^2 + ((cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2)^2];


    C = [ - dq2*((cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) + (cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2) + (cos(q1)^2*cos(q2)*sin(q2))/4 + (cos(q2)*sin(q1)^2*sin(q2))/4) - dq3*(((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2) + ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)),                                                                                                                                                                                                                                                                                                                                                     dq3*(((cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2) + ((sin(q1)*sin(q2)*sin(q3))/2 - (cos(q2)*cos(q3)*sin(q1))/2)*(cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)) - dq1*((cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) + (cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2) + (cos(q1)^2*cos(q2)*sin(q2))/4 + (cos(q2)*sin(q1)^2*sin(q2))/4),                                                                                                                                                                                                           dq2*(((cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2) + ((sin(q1)*sin(q2)*sin(q3))/2 - (cos(q2)*cos(q3)*sin(q1))/2)*(cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)) - dq1*(((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2) + ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)) + dq3*(((cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2) + ((sin(q1)*sin(q2)*sin(q3))/2 - (cos(q2)*cos(q3)*sin(q1))/2)*(cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2))
        dq1*((cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) + (cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2) + (cos(q1)^2*cos(q2)*sin(q2))/4 + (cos(q2)*sin(q1)^2*sin(q2))/4) - dq3*(((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2) - ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)),                                                                                                             dq2*((cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) - (cos(q2) + (cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2)*(sin(q2) + (cos(q2)*sin(q3))/2 + (cos(q3)*sin(q2))/2) - (cos(q2)*sin(q2))/4 + (cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2) + (cos(q1)^2*cos(q2)*sin(q2))/4 + (cos(q2)*sin(q1)^2*sin(q2))/4) - dq3*(((sin(q1)*sin(q2)*sin(q3))/2 - (cos(q2)*cos(q3)*sin(q1))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) + ((cos(q2)*sin(q3))/2 + (cos(q3)*sin(q2))/2)*(cos(q2) + (cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2) - ((cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)), - dq1*(((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2) - ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)) - dq2*(((sin(q1)*sin(q2)*sin(q3))/2 - (cos(q2)*cos(q3)*sin(q1))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) + ((cos(q2)*sin(q3))/2 + (cos(q3)*sin(q2))/2)*(cos(q2) + (cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2) - ((cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)) - dq3*(((sin(q1)*sin(q2)*sin(q3))/2 - (cos(q2)*cos(q3)*sin(q1))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) + ((cos(q2)*sin(q3))/2 + (cos(q3)*sin(q2))/2)*(cos(q2) + (cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2) - ((cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2))
        dq1*(((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2) + ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)) + dq2*(((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2) - ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)), dq1*(((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(cos(q1)*sin(q2) + (cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2) - ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(sin(q1)*sin(q2) + (cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)) - dq3*(((sin(q1)*sin(q2)*sin(q3))/2 - (cos(q2)*cos(q3)*sin(q1))/2)*((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) + ((cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2)*((cos(q2)*sin(q3))/2 + (cos(q3)*sin(q2))/2) - ((cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)) + dq2*(((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2)*(cos(q2)*sin(q1) - (sin(q1)*sin(q2)*sin(q3))/2 + (cos(q2)*cos(q3)*sin(q1))/2) - ((cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2)*(sin(q2) + (cos(q2)*sin(q3))/2 + (cos(q3)*sin(q2))/2) + ((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)*(cos(q1)*cos(q2) + (cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)),                                                                                                                                                                                                                                                                                                                                                                                           - dq2*(((sin(q1)*sin(q2)*sin(q3))/2 - (cos(q2)*cos(q3)*sin(q1))/2)*((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) + ((cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2)*((cos(q2)*sin(q3))/2 + (cos(q3)*sin(q2))/2) - ((cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2)) - dq3*(((sin(q1)*sin(q2)*sin(q3))/2 - (cos(q2)*cos(q3)*sin(q1))/2)*((cos(q2)*sin(q1)*sin(q3))/2 + (cos(q3)*sin(q1)*sin(q2))/2) + ((cos(q2)*cos(q3))/2 - (sin(q2)*sin(q3))/2)*((cos(q2)*sin(q3))/2 + (cos(q3)*sin(q2))/2) - ((cos(q1)*cos(q2)*cos(q3))/2 - (cos(q1)*sin(q2)*sin(q3))/2)*((cos(q1)*cos(q2)*sin(q3))/2 + (cos(q1)*cos(q3)*sin(q2))/2))];
   
    G =  [           0
        (981*cos(q2 + q3))/200 + (2943*cos(q2))/200
        (981*cos(q2 + q3))/200];
 

    fx1 = X(4:6);
    fx2 = M^-1 * (- C * X(4:6) - G);
    gx1 = zeros(3,3);
    gx2 = M^-1;
    
    fx = [fx1; fx2];
    gx = [gx1; gx2];
    
    DynamicPar.M = M;
    DynamicPar.C = C;
    DynamicPar.G = G;
    DynamicPar.RobotPar = Robot;
    
    [u,s,e,de] = Controller(t,X,DynamicPar);
    extraOut.u = u;
    extraOut.s = s;
    extraOut.e = e;
    extraOut.de = de;

    disturbance = 1 * sin(t);
    u = u + disturbance;

    dX = fx + gx * u;
end